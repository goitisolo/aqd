PREFIX rod: <http://rod.eionet.europa.eu/schema.rdf#>
PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
PREFIX dcterms: <http://purl.org/dc/terms/>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX cr: <http://cr.eionet.europa.eu/ontologies/contreg.rdf#>
PREFIX aqd: <http://rdfdata.eionet.europa.eu/airquality/ontology/>
PREFIX aq: <http://reference.eionet.europa.eu/aq/ontology/>
PREFIX aqdd: <http://dd.eionet.europa.eu/property/>

SELECT
#DISTINCT  
bif:concat(xsd:string(YEAR(?reportingBegin)), '-', ?AttainmentId ) as ?_id
?CountryOrTerritory
YEAR(?reportingBegin) as ?ReportingYear
?Namespace
?AttainmentId
?AssessmentId
?ZoneId
?ResidentPopulation
?Pollutant
?ObjectiveType
?ReportingMetric
?ProtectionTarget
(bif:either(?Exceedance > 0,"TRUE","FALSE") as ?ExceedanceFinal)
?ExceedanceThreshold
?AggregationType
?FinalNumericalExceedance
?FinalNumberExceedances
?ClassificationArea
?SurfaceAreaFinal
?RoadLengthFinal
?PopulationExposedFinal
?SensitivePopulationFinal
?EcosystemAreaExposedFinal
?InfrastructureServicesFinal
?ReferenceYearFinal
#?ExceedanceDurationBegin
#?ExceedanceDurationEnd
#?BaseNumericalExceedance
#?BaseNumberExceedances
?Adjustment
#?AdjustmentSource
?AdjustmentType
#?AssessmentType
#?AssessmentTypeDescription
?ModellingAdjustment
?SamplingAdjustment
?Comment
?envelope


 WHERE {


?attURI a aqd:AQD_Attainment;

      aqd:environmentalObjective ?envURI ;
      aqd:assessment ?areURI ;
      aqd:zone ?ZoneURI ;
      aqd:pollutant ?PollutantURI ;
      aqd:inspireId ?inspireId .
       ?inspireId aqd:localId ?AttainmentId;
        aqd:namespace ?Namespace .

?envelope rod:hasFile ?source .
?envelope rod:locality ?locURI .
?locURI rdfs:label ?CountryOrTerritory .
           
OPTIONAL{?areURI aq:inspireId ?AssessmentId} .
?PollutantURI skos:notation ?Pollutant .


OPTIONAL{?attURI aqd:declarationFor ?declarationFor.
?declarationFor aq:reportingBegin ?reportingBegin} .

#OPTIONAL{?attURI aqd:comment ?Comment} .

OPTIONAL{?attURI aqd:exceedanceDescriptionFinal ?exceedanceDescriptionFinal.
?exceedanceDescriptionFinal   aqd:exceedance ?Exceedance} .

OPTIONAL{?attURI aqd:assessmentTypeDescription ?AssessmentTypeDescription} .
OPTIONAL{?attURI aqd:assessmentType ?asstypeURI} .
OPTIONAL{?asstypeURI rdfs:label ?AssessmentType} .
OPTIONAL{?attURI aqd:adjustmentSource ?sourceAdjURI} .
OPTIONAL{?sourceAdjURI rdfs:label ?AdjustmentSource} .
OPTIONAL{?attURI aqd:adjustmentType ?excAdjURI} .
OPTIONAL{?excAdjURI rdfs:label ?AdjustmentType} .

OPTIONAL{?attURI aqd:declarationFor ?declarationFor.
?declarationFor aq:finalDeductionMethod ?corrURI} .        
OPTIONAL{?corrURI rdfs:label ?Adjustment} .



#OPTIONAL{?attURI aqd:modelAssessmentMetadata ?ModellingAdjustment} .
#OPTIONAL{?attURI aqd:samplingpointAssessmentMetadata ?SamplingAdjustment} .

OPTIONAL{?envURI aqd:reportingMetric ?ReportingMetricURI} .
OPTIONAL{?envURI aqd:objectiveType ?ObjectiveTypeURI} .
OPTIONAL{?envURI aqd:protectionTarget ?ProtectionTargetURI} .


OPTIONAL{?ReportingMetricURI rdfs:label ?ReportingMetric} .
OPTIONAL{?ObjectiveTypeURI rdfs:label ?ObjectiveType} .
OPTIONAL{?ProtectionTargetURI rdfs:label ?ProtectionTarget} .

OPTIONAL{?ZoneURI aq:inspireId ?ZoneId} .
OPTIONAL{?ZoneURI aq:residentPopulation ?ResidentPopulation} .


OPTIONAL{?attURI aqd:declarationFor ?declarationFor.
?declarationFor aq:exceedanceFinal ?FinalNumericalExceedance} .
OPTIONAL{?attURI aqd:declarationFor ?declarationFor.
?declarationFor aq:numberExceedancesFinal ?FinalNumberExceedances} .

#OPTIONAL{?attURI aqr:numericalExceedanceBase ?BaseNumericalExceedance} .
#OPTIONAL{?attURI aqr:numberExceedancesBase ?BaseNumberExceedances} .


OPTIONAL{?AggregationTypeURI aqdd:broaderMetric ?ReportingMetricURI} .

?AggregationTypeURI rdfs:label ?AggregationType .



?thresURI aqdd:relatedPollutant ?PollutantURI .
?thresURI aqdd:aggregationProcess ?AggregationTypeURI .
?thresURI aqdd:hasReportingMetric ?ReportingMetricURI .
?thresURI aqdd:hasObjectiveType ?ObjectiveTypeURI .
?thresURI aqdd:hasProtectionTarget ?ProtectionTargetURI .
?thresURI aqdd:exceedanceThreshold ?ExceedanceThreshold .
?thresURI skos:notation ?NrId .


OPTIONAL{?attURI aqd:areaExceedancefinal ?areaFinalURI} .
OPTIONAL{?attURI aqd:exposureExceedanceFinal ?exposureFinalURI} .

OPTIONAL{?areaFinalURI aq:areaExceedanceFinal ?ClassificationArea} .
OPTIONAL{?areaFinalURI aq:surfaceArea ?SurfaceAreaFinal} .
OPTIONAL{?areaFinalURI aq:roadLength ?RoadLengthFinal} .

OPTIONAL{?exposureFinalURI aq:populationExposed ?PopulationExposedFinal} .
OPTIONAL{?exposureFinalURI aq:ecosystemAreaExposed ?EcosystemAreaExposedFinal} .
OPTIONAL{?exposureFinalURI aq:referenceYear ?ReferenceYearFinal} .
OPTIONAL{?exposureFinalURI aq:sensitivePopulation ?SensitivePopulationFinal} .
OPTIONAL{?exposureFinalURI aq:infrastructureServices ?InfrastructureServicesFinal} .

#FILTER (xsd:int(?NrId) != 85) .
#FILTER regex(?Namespace,"ES.BDCA.AQ") .
#FILTER regex(?PollutantURI, "") .
#ORDER BY ?CountryOrTerritory ASC(?reportingBegin) DESC(?ExceedanceFinal) ASC(?PollutantURI) #DESC(?ReportingMetric) DESC(xsd:int(?#NumericalExceedance)) DESC(xsd:int(?NumberExceedances))

}
